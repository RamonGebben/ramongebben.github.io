<html lang="en"><head><title>React DOM Stream / Daily Javascript</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"><meta name="description" content="

### React DOM Stream

React DOM Stream (GitHub: aickin/react-dom-stream, License: MIT, npm: react-â€¦"><meta name="keywords" content="Javascript, React, ES2015, Daily, Updates"><link rel="icon" type="image/png" href="../../assets/img/favicon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><link rel="stylesheet" href="../../assets/main.css"></head><body><div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a href="/">Home</a></div><div class="nav__link"><a href="/blog">Archive</a></div><div class="logo nav__link"></div></nav></div><main role="main"><div class="grid"><div class="post"><div class="post__content"><h1 class="post__heading">React DOM Stream</h1><div><h3 id="react-dom-stream">React DOM Stream</h3>
<p>React DOM Stream (GitHub: <a href="https://github.com/aickin/react-dom-stream">aickin/react-dom-stream</a>, License: MIT, npm: react-dom-stream)</p>
<p>react-dom-stream is a React renderer for generating markup on a NodeJS server. Unlike the built-in ReactDOM.renderToString, this module renders to a stream.
Streams make this library as much as 47% faster in sending down a full page than ReactDOM.renderToString.</p>
<p>One difficulty with ReactDOM.renderToString is that it is synchronous, which could cost you performance with server-side rendering of React sites. Especially true with large HTML payloads. Which could lead to the following problems as the developer saids:</p>
<blockquote>
<ol>
<li>The server cannot send out any part of the response until all the HTML is created, which means that browsers can&apos;t start working on painting the page until the renderToString call is done. With larger pages, this can introduce a latency of hundreds of milliseconds.</li>
<li>The server has to allocate memory for the entire HTML string.</li>
<li>One call to ReactDOM.renderToString can dominate the CPU and starve out other requests. This is particularly troublesome on servers that serve a mix of small and large pages.</li>
</ol>
</blockquote>
<p>react-dom-stream tries to fix those problems for us.</p>
<p>Let&apos;s take a look, To use the server-side methods, we&apos;ll need to require <code>react-dom-stream/server</code>.
To render an <code>element</code> as a <code>stream</code> using express we would use the <code>renderToString</code> method. This would look something like this:</p>
<pre><code class="lang-javascript"><span class="token keyword">var</span> ReactDOMStream <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;react-dom-stream/server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ReactDOMStream<span class="token punctuation">.</span><span class="token function">renderToString</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Foo prop<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>hash<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// TODO: write the hash out to the page in a script tag</span>
            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>When you are working with static pages where you don&apos;t intend to use React to render on the client side you could use the <code>renderToStaticMarkup</code> method to generates smaller sized markup than <code>renderToString</code>.</p>
<p>Again with an express example:</p>
<pre><code class="lang-javascript"><span class="token keyword">var</span> ReactDOMStream <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;react-dom-stream/server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;/&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>req<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ReactDOMStream<span class="token punctuation">.</span><span class="token function">renderToStaticMarkup</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Foo prop<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>When you are generating server markup using <code>react-dom-stream</code>, <em>you cannot use the standard ReactDOM.render;</em> you must use the render method in <code>react-dom-stream</code>. The difference between react-dom&apos;s version and this one is that this render also takes in the hash returned from <code>renderToString</code>.</p>
<pre><code class="lang-javascript"><span class="token keyword">var</span> ReactDOMStream <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;react-dom-stream&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> hash <span class="token operator">=</span> <span class="token number">1234567890</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// returned from renderToString&apos;s promise and read out into the page</span>
ReactDOMStream<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Foo prop<span class="token operator">=</span><span class="token punctuation">{</span>value<span class="token punctuation">}</span><span class="token operator">/</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
</div><time datetime="2015-10-26" class="post__moment">26 Oct 2015</time><div class="post__author">Authored by Ramon Gebben</div></div></div></div></main><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-68072930-1', 'auto');ga('send', 'pageview');</script></div></body></html>