<html lang="en"><head><title>Smartcrop.js / Daily Javascript</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"><meta name="description" content="

### Smartcrop.js

Smartcrop (GitHub: jwagner/smartcrop.js, License: MIT, npm: smartcrop, bower: smâ€¦"><meta name="keywords" content="Javascript, React, ES2015, Daily, Updates"><link rel="icon" type="image/png" href="../../assets/img/favicon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><link rel="stylesheet" href="../../assets/main.css"></head><body><div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a href="/">Home</a></div><div class="nav__link"><a href="/blog">Archive</a></div><div class="logo nav__link"></div></nav></div><main role="main"><div class="grid"><div class="post"><div class="post__content"><h1 class="post__heading">Smartcrop.js</h1><div><h3 id="smartcrop-js">Smartcrop.js</h3>
<p>Smartcrop (GitHub: <a href="https://github.com/jwagner/smartcrop.js">jwagner/smartcrop.js</a>, License: MIT, npm: smartcrop, bower: smartcrop)</p>
<p>Smartcrop.js is not just another image cropping library. It detects the primary region of an image such as faces.
It does this using the following algorithm.</p>
<ol>
<li>Find edges using <a href="https://en.wikipedia.org/wiki/Laplace&apos;s_method">Laplace method</a></li>
<li>Find regions with a color like skin</li>
<li>Find regions high in saturation</li>
<li>Generate a set of candidate crops using a sliding window</li>
<li>Rank them using a importance function to focus the detail in the center and avoid it in the edges.</li>
<li>Output the candidate crop with the highest rank</li>
</ol>
<p>Using it in a simple example:</p>
<pre><code class="lang-javascript">SmartCrop<span class="token punctuation">.</span><span class="token function">crop</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token punctuation">{</span>width<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> height<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">}</span><span class="token punctuation">,</span> result <span class="token operator">=</span><span class="token operator">&gt;</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// Which will return</span>
<span class="token comment" spellcheck="true">// -&gt; {topCrop: {x: 300, y: 200, height: 200, width: 200}}</span>
</code></pre>
<p>When you wanna use it within node.js you would have to do something like this:</p>
<pre><code class="lang-javascript"><span class="token keyword">import</span> fs from <span class="token string">&apos;fs&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Canvas from <span class="token string">&apos;canvas&apos;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> SmartCrop from <span class="token string">&apos;smartcrop&apos;</span><span class="token punctuation">;</span>

SmartCrop<span class="token punctuation">.</span><span class="token function">crop</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> options<span class="token punctuation">,</span> result <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>JSON<span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>output <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>width <span class="token operator">&amp;&amp;</span> options<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">var</span> canvas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Canvas</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>width<span class="token punctuation">,</span> options<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">,</span>
            ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">&apos;2d&apos;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            crop <span class="token operator">=</span> result<span class="token punctuation">.</span>topCrop<span class="token punctuation">,</span>
            f <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span>patternQuality <span class="token operator">=</span> <span class="token string">&apos;best&apos;</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span>filter <span class="token operator">=</span> <span class="token string">&apos;best&apos;</span><span class="token punctuation">;</span>
        ctx<span class="token punctuation">.</span><span class="token function">drawImage</span><span class="token punctuation">(</span>img<span class="token punctuation">,</span> crop<span class="token punctuation">.</span>x<span class="token punctuation">,</span> crop<span class="token punctuation">.</span>y<span class="token punctuation">,</span> crop<span class="token punctuation">.</span>width<span class="token punctuation">,</span> crop<span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>width<span class="token punctuation">,</span> canvas<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span><span class="token function">syncJPEGStream</span><span class="token punctuation">(</span><span class="token punctuation">{</span>quality<span class="token punctuation">:</span> quality<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Smartcrop.js also offers a command line interface under the npm package name <a href="https://github.com/jwagner/smartcrop-cli"><code>smartcrop-cli</code></a>. Which based uses node-canvas.</p>
<p>That one you would use like this:</p>
<pre><code class="lang-bash">npm i smartcrop<span class="token operator">-</span>cli <span class="token operator">-</span>g
smartcrop<span class="token operator">-</span>cli <span class="token operator">--</span>width <span class="token number">100</span> <span class="token operator">--</span>height <span class="token number">100</span> photo<span class="token punctuation">.</span>jpg square<span class="token operator">-</span>thumbnail<span class="token punctuation">.</span>jpg
</code></pre>
<p>Smartcrop-cli does requires <a href="https://github.com/Automattic/node-canvas">node-canvas</a> which requires local libraries to be installed. Refer to the <a href="https://github.com/Automattic/node-canvas/wiki/_pages">node-canvas wiki</a> installation instructions.</p>
</div><time datetime="2015-10-14" class="post__moment">14 Oct 2015</time><div class="post__author">Authored by Ramon Gebben</div></div></div></div></main><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-68072930-1', 'auto');ga('send', 'pageview');</script></div></body></html>