<html lang="en"><head><title>Levi / Daily Javascript</title><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimal-ui"><meta name="description" content="

### Levi

Levi (GitHub: cshum/levi, License: MIT, npm: levi)

Levi is a streaming full-text searchâ€¦"><meta name="keywords" content="Javascript, React, ES2015, Daily, Updates"><link rel="icon" type="image/png" href="../../assets/img/favicon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><link rel="stylesheet" href="../../assets/main.css"></head><body><div><div class="nav__wrapper"><input type="checkbox" class="nav__toggle" id="nav__toggle"><label class="nav__toggle-label" for="nav__toggle"></label><nav class="nav"><div class="nav__link"><a href="/">Home</a></div><div class="nav__link"><a href="/blog">Archive</a></div><div class="logo nav__link"></div></nav></div><main role="main"><div class="grid"><div class="post"><div class="post__content"><h1 class="post__heading">Levi</h1><div><h3 id="levi">Levi</h3>
<p>Levi (GitHub: <a href="https://github.com/cshum/levi">cshum/levi</a>, License: MIT, npm: levi)</p>
<p>Levi is a streaming full-text search for Node.js and browsers which used LevelDB for storage.
The search implementation is done by using <a href="https://en.wikipedia.org/wiki/Tf%E2%80%93idf">TF-IDF</a> and <a href="https://en.wikipedia.org/wiki/Cosine_similarity">cosine similarity</a>, and it&#x2019;s provided with configurable text processing pipelines: Tokenizer, Porter Stemmer and Stopwords filter.</p>
<p>Levi is built on <a href="https://github.com/Level/levelup">LevelUP</a> which is a fast, asynchronous, transactional storage interface. By default it uses LevelDB on Node.js, when in running in the browser it uses <a href="https://github.com/maxogden/level.js">IndexedDB</a>. Levi supports with a variety of LevelDOWN compatible backends.</p>
<p>In addition, Levi provides relevancy scoring for live changing data using TF-ICF - a TF-IDF approximation based on existing corpus. Such scoring matches are comparably close to TF-IDF when existing corpus is sufficiently large, with significantly better performance O(N) instead of O(N^2).</p>
<p>Let&apos;s take a look at the API. To get started, we need to create a new Levi instance. We do that like this:</p>
<pre><code class="lang-javascript"><span class="token keyword">import</span> levi from <span class="token string">&apos;levi&apos;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> lv <span class="token operator">=</span> <span class="token function">levi</span><span class="token punctuation">(</span><span class="token string">&apos;db&apos;</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>levi<span class="token punctuation">.</span><span class="token function">tokenizer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>levi<span class="token punctuation">.</span><span class="token function">stemmer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>levi<span class="token punctuation">.</span><span class="token function">stopword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>The text processing pipeline <code>levi.tokenizer()</code>, <code>levi.stemmer()</code>, <code>levi.stopword()</code> are required for indexing. These are exposed as <a href="https://github.com/cshum/ginga">ginga</a> plugins so that they can be swapped for different language configurations.</p>
<p>Now that we have an instance we can use it to talk to the API like this:</p>
<pre><code class="lang-javascript">lv<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&apos;a&apos;</span><span class="token punctuation">,</span> <span class="token string">&apos;Lorem Ipsum is simply dummy text.&apos;</span><span class="token punctuation">,</span> err <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// ...</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// object fields as value</span>
lv<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&apos;b&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token string">&apos;b&apos;</span><span class="token punctuation">,</span>
  title<span class="token punctuation">:</span> <span class="token string">&apos;Lorem Ipsum&apos;</span><span class="token punctuation">,</span>
  body<span class="token punctuation">:</span> <span class="token string">&apos;Dummy text of the printing and typesetting industry.&apos;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Or retrieve it like:</p>
<pre><code class="lang-javascript">lv<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&apos;b&apos;</span><span class="token punctuation">,</span> res <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// res here;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>To actually search we need to use Levi&apos;s main interface which would be <code>searchStream</code>. We use that like this.</p>
<pre><code class="lang-javascript">lv<span class="token punctuation">.</span><span class="token function">searchStream</span><span class="token punctuation">(</span><span class="token string">&apos;lorem ipsum&apos;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">// highland method</span>

lv<span class="token punctuation">.</span><span class="token function">searchStream</span><span class="token punctuation">(</span><span class="token string">&apos;lorem ipsum&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  fields<span class="token punctuation">:</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token string">&apos;*&apos;</span><span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// title field boost. &apos;*&apos; means any field</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

lv<span class="token punctuation">.</span><span class="token function">searchStream</span><span class="token punctuation">(</span><span class="token string">&apos;lorem ipusm&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  fields<span class="token punctuation">:</span> <span class="token punctuation">{</span> title<span class="token punctuation">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// title only</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// ltgt</span>
lv<span class="token punctuation">.</span><span class="token function">searchStream</span><span class="token punctuation">(</span><span class="token string">&apos;lorem ipusm&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  gt<span class="token punctuation">:</span> <span class="token string">&apos;!posts!&apos;</span><span class="token punctuation">,</span>
  lt<span class="token punctuation">:</span> <span class="token string">&apos;!posts!~&apos;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true">// document as query</span>
lv<span class="token punctuation">.</span><span class="token function">searchStream</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  title<span class="token punctuation">:</span> <span class="token string">&apos;Lorem Ipsum&apos;</span><span class="token punctuation">,</span>
  body<span class="token punctuation">:</span> <span class="token string">&apos;Dummy text of the printing and typesetting industry.&apos;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span>
</code></pre>
<p>Because I do not fully understand everything that is going on here, I need to refer you to the extensive documentation on the <a href="https://github.com/cshum/levi">GitHub page</a>. The reason I still mention this library is that I understand from the explanation a colleague gave me that this library will have a significant impact on the speed of your text search.</p>
</div><time datetime="2015-09-28" class="post__moment">28 Sep 2015</time><div class="post__author">Authored by Ramon Gebben</div></div></div></div></main><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-68072930-1', 'auto');ga('send', 'pageview');</script></div></body></html>